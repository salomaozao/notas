#### Antes de começar:
 - todo modelo que foi ajustado `aov()` tem como classes:
``` 
	class(mod)
## "lm", "aov"
```
- Temos, também que:
$$
\begin{eqnarray}
  \hat{\beta}_{0} \sim N\left(\beta_{0}; \sigma^2\left[\frac{1}{n}+\frac{\bar{x}^2}{S_{xx}}\right] \right) ~ \mbox{ e } ~ \hat{\beta}_{1} \sim N\left(\beta_{1};\frac{\sigma^{2}}{S_{xx}}\right). \nonumber
\end{eqnarray}
$$
***** 
Vamos iniciar nossa discussão mostrando como construir um intervalo de confiança de $100(1-\alpha)\%$ para a resposta média, dado um valor $x_0$, que denoratemos por $\mu_{y_{0}|x_{0}}$.

## Modelando a média

Temos que X é o "fator" e Y é a "variável resposta"
Vamos iniciar nossa discussão mostrando como construir um intervalo de confiança para a resposta média, dado um valor $x_0$

Dado que $\mu_{y_{0}|x_{0}} = E(y_{0}|x_{0}) = \beta_{0} + \beta_{1}x_{0}$, segue o estimador pontual para $\mu_{y_{0}|x_{0}}$, que é a média, que é o mesmo estimador para $\hat{y}$: 

$$\begin{eqnarray}
    \hat{\mu}_{y_{0}|x_{0}} = \hat{y}=\hat{\beta_{0}} + \hat{\beta_{1}}x_{0} \nonumber
\end{eqnarray}$$
Isso se dá por que estamos **modelando a média**, uma vez que $y \sim N(\beta_{0} + \beta_{1}x_{0})$. Logo, temos também as seguintes propriedades:
$$E(\hat{\mu}_{y_{0}|x_{0}}) = \beta_{0} + \beta_{1}x_{0}$$$$ V(\widehat{\mu}_{y_{0}|x_{0}}) = \sigma^2\left( \frac{1}{n} + \frac{(x_{0}-\bar{x})^2}{S_{xx}} \right)$$
Onde, uma vez que temos a média e variância, e $\hat{\mu}_{y_{0}|x_{0}}$ é combinação linear de $\beta_0$ e $\beta_1$:
$$\begin{eqnarray}
    \hat{\mu}_{y_{0}|x_{0}} \sim N\left(\beta_{0} + \beta_{1}x_{0};\sigma^2\left[ \frac{1}{n} + \frac{(x_{0}-\bar{x})^2}{S_{xx}}\right] \right).    \nonumber
\end{eqnarray}$$$$\begin{eqnarray}
        IC[\mu_{y_{0}|x_{0}};100(1-\alpha)\%] = \hat{\mu}_{y_{0}|x_{0}} \pm t_{(n-2; \frac{\alpha}{2})}\sqrt{QMRes\left(\frac{1}{n} + \frac{(x_{0}-\bar{x})^2}{S_{xx}} \right)}. \nonumber
    \end{eqnarray}$$
### Erro de Previsão:
$$
\begin{eqnarray}
        \sum_{i=1}^{n}(y_{i}-\bar{y})^2 = \sum_{i=1}^{n}(\hat{y}_{i}-\bar{y})^2 + \sum_{i=1}^{n}(y_{i}-\hat{y}_{i})^2. \nonumber
    \end{eqnarray}
$$

O erro de previsão é definido da seguinte forma: $\hat{e}_{0} = \hat{y}_{0}-y_{0}$, onde:
$$
\begin{eqnarray}
    \hat{y}_{0} - y_{0}  \sim N\left(0;\sigma^2\left[ 1 + \frac{1}{n} + \frac{(x_{0}-\bar{x})^2}{S_{xx}}\right] \right).    \nonumber
\end{eqnarray}
$$
$$
\begin{eqnarray}
        IC[y_{0};100(1-\alpha)\%] = \hat{y}_{0} \pm t_{(n-2; \frac{\alpha}{2})}\sqrt{QMRes\left( 1 + \frac{1}{n} + \frac{(x_{0}-\bar{x})^2}{S_{xx}} \right)} \nonumber
    \end{eqnarray}
$$

(?) Entender por que as equações de intervalo de confiança tem QMRes
## Caso de uso:
```
library(reglin)

# ajustando o modelo:
fit <- lm(pureza ~ percentual, data = pureza)

# especificando os valores desejados para a covariável percentual: (?)
newcov <- data.frame(percentual = seq(0.9, 1.5, by = 0.1))
newcov
```

```
percentual
1        0.9
2        1.0
3        1.1
4        1.2
5        1.3
6        1.4
7        1.5
```


```
# IC para respostas médias de novas observações:
print(predict(fit, newdata = newcov))
```

```
1        2        3        4        5        6        7
87.73605 89.23079 90.72554 92.22029 93.71504 95.20979 96.70453
```

Ou seja:

| Percentual | Pureza prevista ($\hat{y_i}$) |
| ---------- | ----------------------------- |
| 0.9        | 87.73605                      |
| 1          | 89.23079                      |
| 1.1        | 90.72554                      |
| 1.2        | 92.22029                      |
| 1.3        | 93.71504                      |
| 1.4        | 95.20979                      |
| 1.5        | 96.70453                      |

```
# IC para para previsõeos de novas observações:
predict(fit, newdata = newcov, interval = "prediction")
```

```
       fit      lwr      upr
1 87.73605 85.25777 90.21432
2 89.23079 86.82969 91.63190
3 90.72554 88.37143 93.07965
4 92.22029 89.88118 94.55940
5 93.71504 91.35833 96.07175
6 95.20979 92.80358 97.61599
7 96.70453 94.21886 99.19021
```

